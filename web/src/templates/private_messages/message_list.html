{% extends "private_messages/includes/base.html" %}

{% load i18n messages %}

{% block title %}{% trans 'Message list' %}{% endblock %}

{% block js_files %}
  {{ block.super }}
  <script src="{{ STATIC_URL }}js/spin.min.js"></script>
{% endblock %}

{% block left %}
  {% include "private_messages/includes/mail_actions.html" %}
{% endblock %}

{% block container %}
<div class="pull-right"><a class="btn btn-primary" href="{% url private_messages_new %}"><i class="icon-pencil"></i> {% trans "REDACTAR" %}</a></div>
<legend>{% get_header request %}</legend>
  {% if messages.object_list.count > 0 %}

    <table id="message_list" class="table table-striped">
      <thead></thead>
      <tbody>
        {% for message in messages.object_list %}
          {% include "private_messages/message_detail.html" %}
        {% endfor %}
      </tbody>
    </table>
    <div id="message-paginator" class="pagination pagination-centered">
      <ul>
        {% if messages.has_previous %}
          <li><a href="?page={{ messages.previous_page_number }}">←</a></li>
        {% else %}
          <li class="disabled"><a>←</a></li>
        {% endif %}

        {% if messages.has_next %}
          <li><a href="?page={{ messages.next_page_number }}">→</a></li>
        {% else %}
          <li class="disabled"><a>→</a></li>
        {% endif %}
      </ul>
    </div>
    
  {% else %}
    <h6>{% trans "No hay mensajes" %}</h6>
  {% endif %}
{% endblock %}

{% block right %}
<div id="preview" class="alert alert-info"></div>
{% endblock %}

{% block jquery_init %}

$('table tbody tr').on('click', function(event){
  var id = $(this).attr('data-msg');
  var sp = start_spinner('preview');

  $('#preview').load("/messages/view/" + id, function() {
     sp.stop();
  });
});

function start_spinner(el){
  return create_spinner_on(el);
}

function create_spinner_on(el){
  var opts = {
    lines: 13, // The number of lines to draw
    length: 7, // The length of each line
    width: 4, // The line thickness
    radius: 10, // The radius of the inner circle
    rotate: 0, // The rotation offset
    color: '#000', // #rgb or #rrggbb
    speed: 1, // Rounds per second
    trail: 60, // Afterglow percentage
    shadow: false, // Whether to render a shadow
    hwaccel: false, // Whether to use hardware acceleration
    className: 'spinner', // The CSS class to assign to the spinner
    zIndex: 2e9, // The z-index (defaults to 2000000000)
    top: '0px', // Top position relative to parent in px
    left: '0px' // Left position relative to parent in px
  };

  var target =  document.getElementById(el);
  var spinner = new Spinner(opts).spin(target);
  return spinner;
}

{% endblock %}
