{% extends "cal/includes/base.html" %}

{% load i18n messages %}

{% block title %}{% trans 'Nueva cita' %}{% endblock %}

{% block left_panel %}
  {% include "cal/includes/calendar_new_app_admin.html" %}
{% endblock %}

{% block right_panel %}
  <legend>{{ day }} {% trans "of" %} {{ mname }} {% trans "of" %} {{ year }}</legend>

  <div class="well">
    <p>Dr. {{ doctor.get_profile.name }} {{ doctor.get_profile.first_surname }}</p>
  </div>
  <div class="well">
    <p>{% trans "Paciente:" %} {{ patient.get_profile.name }} {{ patient.get_profile.first_surname }}</p>
  </div>
  <div class="row">
    <div class="span5">
      <div class="btn-toolbar" style="margin-bottom: 9px">
          <div class="btn-group">
            <a class="btn btn-primary btn" href="{% url cal.app_add_new_app_admin year month day doctor.id patient.id %}"><i class="icon-pencil icon-white"></i> {% trans "New appointment" %}</a>
          </div>
      </div>
    </div>
  </div>

  {% if events.object_list.count > 0 %}
    <div id="events-paginator" class="pull-right">
      <ul class="pagination ">
        {% if events.has_previous %}
          <li><a href="?page={{ events.previous_page_number }}">←</a></li>
        {% else %}
          <li class="disabled"><a>←</a></li>
        {% endif %}

        {% if events.has_next %}
          <li><a href="?page={{ events.next_page_number }}">→</a></li>
        {% else %}
          <li class="disabled"><a>→</a></li>
        {% endif %}
      </ul>
    </div>

    <table id="events_list" class="table table-striped">
      <thead>
          <tr>
            <th>{% trans "Date" %}</th>
            <th>{% trans "Start Time" %}</th>
            <th>{% trans "End Time" %}</th>
            <th>{% trans "Duration (min)" %}</th>
            <th>{% trans "Patient" %}</th>
            <th>{% trans "Appointment type" %}</th>
            <th>{% trans "Note" %}</th>
          </tr>
      </thead>
      <tbody>
        {% for event in events.object_list %}
          {% include "cal/app/appointment.html" %}
        {% endfor %}
      </tbody>
    </table>

    <div id="preview"></div>
  {% else %}
    <h6>{% trans "There are no appointments" %}</h6>
  {% endif %}
  {% include "cal/app/free_slots.html" %}
{% endblock %}
{% block jquery_init %}
var load_icon = "<img src='{{STATIC_URL}}img/loading.gif' alt='loading...'/>";

$('table tbody tr').live('click', function(event){
  var id = $(this).attr('data-msg');
  var id_patient = $(this).attr('id');
  if(id){
    $('table').hide();
    window.location.href = '/calendar/app/edit/' +id+ '/' + id_patient + '/{{ doctor.id }}';
  }
});
{% endblock %}