<!DOCTYPE html>
<html lang="en">
  <head>
    {% load consulting i18n %}
    <meta charset="utf-8">
    <title>{% get_brand %}{% block title %}{% endblock %}</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="">
    <meta name="author" content="">

    {% block js_files %}
      <script src="{{ STATIC_URL }}js/jquery-1.8.2.js"></script>
      <script src="{{ STATIC_URL }}js/jquery.form.js"></script>
      <script src="{{ STATIC_URL }}js/bootstrap.js"></script>
      <!--[if lte IE 8]><script language="javascript" type="text/javascript" src="{{ STATIC_URL }}js/excanvas.min.js"></script><![endif]-->
      <script src="{{ STATIC_URL }}js/bootstrap-editable.js"></script>
    {% endblock %}

    {% block css_files %}
      <link href="{{ STATIC_URL }}css/app.css" rel="stylesheet"/>
      <link href="{{ STATIC_URL }}css/bootstrap.css" rel="stylesheet"/>      
      <link href="{{ STATIC_URL }}css/bootstrap-editable.css" rel="stylesheet">
      <link href="{{ STATIC_URL }}css/table-calendar.css" rel="stylesheet"/>
    {% endblock %}

    <style type="text/css">
        @media (min-width: 768px) and (max-width: 1024px){
          #calendar table {
           font-size:0.8em
          }
          .pagination {
            min-width: 220px
          }
        }
        @media(max-width:1024px){
          h1{
             font-size:2em 
            }
          }
    {% block css_inline %}
    {% endblock %}
    </style>

    <script type="text/javascript">
      function fix_bars(){
        if (!$.browser.msie || $.browser.version >= '9') {
          if ($(window).width() >= 1024) {
            $("div.fixable").affix({offset: {y: 10}});
          }
          else {
            $("div.fixable").removeAttr('data-spy');
          }
        } else {
          if ($(window).width() > 1170) {
            $("div.container").css('width', 1170);
            for (var i=1; i<=12; i++) {
              $("div.span"+i).not(".relative").css('width', (i-1)*100+70);
            }
          }
          else {
            $("div.container").not(".relative").css('width', 940);
            for (var i=1; i<=12; i++) {
              $("div.span"+i).not(".relative").css('width', (i*80)-20);
            }
          }
        }
      };
      var timer;
      var reminder = 300; // seg
      function expiration_warning() {
        document.title = '{% get_brand %}';
        $('#warning_modal').modal('show');
        $('#timeout').text(reminder);
        timer = setInterval(function(){
          if (parseInt($('#timeout').text())) {
            $('#timeout').text(parseInt($('#timeout').text()) - 1)
            if (parseInt($('#timeout').text()) % 2) {
              document.title = '{% get_brand %}';
            } else {
              document.title = 'Aviso';
            }
          } else {
            $('#warning_modal').modal('hide');
            document.title = '{% get_brand %}';
            clearInterval(timer);
          }
        }, 1000);
      }
      function postpone_session(val) {
        $.ajax( '/keep_alive/'+val+'/' )
        .done( setTimeout(expiration_warning, (val - reminder ) * 1000) )
        .fail(function() { alert("error"); })
        .always(function() { 
          $('#warning_modal').modal('hide'); 
          clearInterval(timer);});
      }
      {% block js %}
      {% endblock %}

      $(document).ready(function(){
        $("#notes").editable();
        $(window).resize(fix_bars);
        $('a[rel="tooltip"]').tooltip();
        $('#warning_modal').find('a.btn').on('click', function(ev) {
          ev.preventDefault();
          postpone_session($(this).attr('value'));
        });
        setTimeout(expiration_warning,({{request.session.timeout}} - reminder) * 1000);
        {% block jquery_init %}
        {% endblock %}
        fix_bars();
      });
    </script>

  </head>

  <body>
    {% block header%}
      {% if request.user.get_profile.is_doctor %}
        {% include "ui/includes/header_doctor.html" with user=request.user %}
      {% else %}
        {% if request.user.get_profile.is_administrative %}
          {% include "ui/includes/header_administrative.html" with user=request.user %}
        {% else %}
          {% if request.user.get_profile.is_patient %}
            {% include "ui/includes/header_patient.html" with user=request.user %}
          {% endif%}
        {% endif%}
      {% endif%}
    {% endblock  %}
    {% block nav-bar%}{% endblock  %}
    <div class="offset2 span10 pull-right">
    {% block subheader %}
    {% endblock subheader %}
     
    </div>

    {% block body %}
    <div class="container">
      <div class="row-fluid">
        <div id="left_bar" class="span2">
          <div class="fixable" style="max-width:180px">
          {% block left %}
          <!--Left Sidebar content-->&nbsp;
          {% endblock left%}
          </div>
        </div>    
        <div id="main" class="span7">
          {% block container %}
           <!--Body content-->
          {% endblock container %}
        </div>
        <div id="right_bar" class="span3">
          <div class="fixable" style="max-width:270px">
          {% block right %}
          <!--Right Sidebar content-->
          {% endblock right %}
          </div>
        </div>
        <div id="large" class="span10">
          {% block large %}
          {% endblock %} 
        </div>
      </div>
    </div>
    {% endblock body %}

    <div id="warning_modal" class="modal hide fade">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
        <h3>{% trans 'Aviso de fin de sesi칩n programado' %}</h3>
      </div>
      <div class="modal-body">
       <p id="warning_msg">Su sesi칩n expirar치 en <strong id="timeout">60</strong> segundos.</p>
       <p>{% trans 'Mantener la sesi칩n abierta y no volver a recordarlo durante... ' %}</p>
      </div>
      <div class="modal-footer">
        <a href="#" value="1800" class="btn btn-info">{% trans '30 minutos' %}</a>
        <a href="#" value="3600" class="btn btn-info">{% trans '1 hora' %}</a>
        <a href="#" value="7200" class="btn btn-info">{% trans '2 horas' %}</a>
        <a href="#" value="{{SESSION_TIMEOUT}}" class="btn btn-primary">{% trans 'Predeterminado del sistema' %}</a>
      </div>
    </div>

    {% block footer%}
      {% include 'ui/includes/footer.html' %}
    {% endblock %}
  </body>
</html>
