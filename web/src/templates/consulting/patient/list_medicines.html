{% extends "consulting/patient/personal_data_pm.html" %}

{% load i18n%}

{% block jquery_init %}
  $('.medicine').each(function(){
      $(this).on("click", function(){ 
          var medicine_id = $(this).attr("id");

          $(this).css("background", "#D9EDF7").siblings().removeAttr("style")

          $('#overwrite').load(
                '{% url consulting_detail_medicine_pm %}',
                {'medicine_id': medicine_id,
                'csrfmiddlewaretoken': $('input[name="csrfmiddlewaretoken"]').val()});
          });
  });

  <!-- REMOVE MEDICINE -->
  $('.remove_medicine').each(function(){
    $(this).on("click", function(){ 
                            var id = $(this).attr("id");
                            $('#medicine_id').val(id);     
                        });      
  });

  $("#yes").click(function(){
                    medicine_id = $('#medicine_id').val()
                    $('#overwrite_list').load(
                                  '{% url consulting_remove_medicine_pm %}',
                                  {'medicine_id': medicine_id,
                                  'csrfmiddlewaretoken': $('input[name="csrfmiddlewaretoken"]').val()});
  });
{% endblock %}



{% block container %}
<input name="csrfmiddlewaretoken" type="hidden" value="{{csrf_token}}">
<section>
  <div class="page-header row-fluid">
      <h1 class="span5">{% trans 'Tratamiento' %}</h1>
      <ul class="nav nav-pills pull-right">
          <li class="{% if when = 2 %}active{% endif %}">
            <a href="{% url consulting_list_medicines %}">Después de la primera cita</a>
          </li>
         <li class="{% if when = 1 %}active{% endif %}">
            <a href="{% url consulting_list_medicines %}?when=before">Antes de la primera cita</a>
         </li>
       </ul>                
  </div>
    <div>      
    <div id="overwrite_list" class=""> 
      <div class="span3 center">           
      {% if medicines.object_list %}               
      <table id="list_medicine" class="table table-bordered table-condensed">  
        <thead>
          <tr>            
            <th style="text-align:center;">
              {% trans 'FECHA' %}
            </th>
            <th style="text-align:center;">
              {% trans 'Fármaco' %}
            </th>
            <th></th>                
          </tr>
        </thead>        
        <tbody>                  
          {% for medicine in medicines.object_list %}
            <tr id="{{medicine.id}}" class="medicine">
              <td style="text-align:center;">{{medicine.date|date:'d/M/Y'}}</td>
              <td style="text-align:center;">{{medicine.component}}</td>                      
              <td class="center">                      
                <a id="{{medicine.id}}" class="icon-trash remove_medicine" data-toggle="modal" href="#check_remove_medicine"></a>
              </td>
            </tr>
          {% endfor %}
        </tbody>
      </table>
      </div>
      <div class="span3 alert alert-info" id="overwrite"></div>
      <div id="medicine-paginator" class="span7 pagination pagination-centered">
        <ul class="pagination">
          {% if medicines.has_previous %}
            <li><a href="?page={{ medicines.previous_page_number }}">←</a></li>
          {% else %}
            <li class="disabled"><a>←</a></li>
          {% endif %}

          {% if medicines.has_next %}
            <li><a href="?page={{ medicines.next_page_number }}">→</a></li>
          {% else %}
            <li class="disabled"><a>→</a></li>
          {% endif %}
        </ul>
      </div>          
                                 
      {% else %}
          <h6>{% trans "No hay fármacos" %}</h6>
      {% endif %}
    </div>
  </div>
  <div id="check_remove_medicine" class="modal hide fade" style="display: block;">
    <input id="medicine_id" type="hidden">
    <div class="modal-header">
        <button class="close" data-dismiss="modal">
          ×
        </button>
        <h3>Borrar Fármaco</h3>
    </div>
    <div class="modal-body">
        <p>
          {% trans '¿Está seguro que quiere borrar éste fármaco?' %}
        </p>
    </div>
    <div class="modal-footer">
      <a id="yes" data-dismiss="modal" href="#" class="btn">Sí</a>
      <a data-dismiss="modal" href="#" class="btn btn-primary">No</a>
    </div>                      
</section>

{% endblock container %}

{% block right %}
  {% include "consulting/patient/card.html" %}
{% endblock %}