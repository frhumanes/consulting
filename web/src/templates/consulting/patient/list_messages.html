{% extends "consulting/patient/personal_data_pm.html" %}

{% load i18n%}


{% block js_files %}
  {{ block.super }}
  <script src="{{ STATIC_URL }}js/spin.min.js"></script>
{% endblock %}


{% block container %}
  <div class="page-header">
    <h1>{% trans 'Mensajes' %}
            <div class="btn-group pull-right">
               <a class="btn btn-info" href="{% url private_messages_new_for patient_user.id %}"><i class="icon-pencil icon-white"></i> {% trans "Redactar" %}</a>
            </div>
        </h1>
  </div>
<div id="mail_area">
  {% if messages.object_list.count > 0 %}
    <div class="accordion" id="accordion2">
      {% for message in messages.object_list %}
      <div class="accordion-group">
        <div class="accordion-heading">
          <a class="accordion-toggle" data-toggle="collapse" data-parent="#accordion2" href="#collapse{{message.id}}">
          <h4>{{ message.subject }}<small class="pull-right">{{ message.sent_at|date:"d M y H:i" }}</small></h4>
          </a>
        </div>
        <div id="collapse{{message.id}}" class="accordion-body collapse">
          <div class="accordion-inner">
          {% include "private_messages/message_conversation.html" with message=message user=patient_user %}
          </div>
        </div>
      </div>
      {% endfor %}
    </div>
    <div id="message-paginator" class="pagination pagination-centered">
      <ul>
        {% if messages.has_previous %}
          <li><a href="?page={{ messages.previous_page_number }}">←</a></li>
        {% else %}
          <li class="disabled"><a>←</a></li>
        {% endif %}

        {% if messages.has_next %}
          <li><a href="?page={{ messages.next_page_number }}">→</a></li>
        {% else %}
          <li class="disabled"><a>→</a></li>
        {% endif %}
      </ul>
    </div>
    
  {% else %}
    <div class="alert alert-info">{% trans "No hay mensajes" %}</div>
  {% endif %}
</div>
{% endblock %}


{% block right %}
  {% include "consulting/patient/card.html" %}
{% endblock %}

{% block jquery_init %}
{% comment  %}
$('table tbody tr').on('click', function(event){
  var id = $(this).attr('data-msg');
  var sp = start_spinner('preview');

  $('#preview').load("/messages/view/" + id, function() {
     sp.stop();
  });
});
{% endcomment %}
function start_spinner(el){
  return create_spinner_on(el);
}

function create_spinner_on(el){
  var opts = {
    lines: 13, // The number of lines to draw
    length: 7, // The length of each line
    width: 4, // The line thickness
    radius: 10, // The radius of the inner circle
    rotate: 0, // The rotation offset
    color: '#000', // #rgb or #rrggbb
    speed: 1, // Rounds per second
    trail: 60, // Afterglow percentage
    shadow: false, // Whether to render a shadow
    hwaccel: false, // Whether to use hardware acceleration
    className: 'spinner', // The CSS class to assign to the spinner
    zIndex: 2e9, // The z-index (defaults to 2000000000)
    top: '0px', // Top position relative to parent in px
    left: '0px' // Left position relative to parent in px
  };

  var target =  document.getElementById(el);
  var spinner = new Spinner(opts).spin(target);
  return spinner;
}

{% endblock %}