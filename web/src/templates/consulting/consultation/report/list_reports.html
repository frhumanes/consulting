{% extends "consulting/patient/personal_data_pm.html" %}

{% load i18n%}

{% block container %}
  <input name="csrfmiddlewaretoken" type="hidden" value="{{csrf_token}}">
  <section>
    <div class="page-header">
        <h1>{% trans 'Listado de Informes' %}</h1>                
    </div>
    <div class="row">       
      <div id="overwrite_list" class="">            
        {% if reports.object_list %}                     
        <table id="list_report" class="table table-bordered table-condensed">  
          <thead>
            <tr>            
              <th style="text-align:center;">
                {% trans 'FECHA' %}
              </th>
              <th style="text-align:center;">
                {% trans 'INFORME' %}
              </th>
              <th style="text-align:center;">
                {% trans 'ANSIEDAD' %}
              </th>
              <th style="text-align:center;">
                {% trans 'DEPRESION' %}
              </th>
              <th style="text-align:center;">
                {% trans 'PDF' %}
              </th>               
            </tr>
          </thead>        
          <tbody>                  
            {% for report in reports.object_list %}
              <tr id="{{report.id}}" class="report">
                <td style="text-align:center;">{% if report.end_date %}{{report.end_date|date:"d/M/Y"|lower}}{% else %}{{report.updated_at|date:"d/M/Y"|lower}}{% endif %}</td>
                <td style="text-align:center;"><a class="btn btn-link" href="{% url 'consulting_view_report' report.id %}" role="button" data-toggle="modal">{{report.survey.name}}</a></td>
                <td style="text-align:center;"><span class="label label-{{report.get_anxiety_status|last}}">{{report.get_anxiety_status|first}}</span></td>
                <td style="text-align:center;"><span class="label label-{{report.get_depression_status|last}}">{{report.get_depression_status|first}}</span></td>              
                <td style="text-align:center;"><a class="btn btn-link" href="{% url 'consulting_view_report' report.id%}?as=pdf" ><i class="icon-download-alt"></i></a>   
                </td>
              </tr>
            {% endfor %}
          </tbody>
        </table>
        {% include 'ui/includes/pagination_bar.html' with objects=reports %}
        <div id="overwrite"></div>                           
        {% else %}
            <div class="alert alert-info">{% trans "No hay Informes" %}</div>
        {% endif %}
      </div>
     
    </div>
             
  </section>

<div class="modal" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
<div class="modal-header">
<button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
<h3 id="myModalLabel">Previsualización de informe</h3>
</div>
<div class="modal-body">
</div>
<div class="modal-footer">
<button class="btn" data-dismiss="modal" aria-hidden="true">Close</button>
<button class="btn btn-primary">Save changes</button>
</div>
</div>
{% endblock container %}

{% block jquery_init %}
$('a[toggle="modal"]').on('click',function(){
  $('#modal-body').load(
                $(this).attr('href'),
                {'csrfmiddlewaretoken': $('input[name="csrfmiddlewaretoken"]').val()});
  $('#myModal').modal();
  return false;
});
{% endblock %}