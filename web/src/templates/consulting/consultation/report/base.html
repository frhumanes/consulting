{% extends as_pdf|yesno:"ui/pdf.html,ui/dummy.html" %}

{% load i18n consulting userprofile %}

{% block container %}
<h2 style="text-align: center">INFORME RESUMEN</h2>
<br>
<h3>CUESTIONARIO: {{task.survey.name|upper}}</h3>
<hr>
<br>
{% if task.survey.id < 3 %}
<p>{{patient.name}} {{patient.first_surname}} {{patient.second_surname}} de {{patient.get_age}} años de edad presenta desde hace {{task.get_time_interval|lower}} los síntomas que le han hecho acudir a consulta.
	{% if task.get_ap_list %}
		Ha sido {{ 'diagnosticado/a'|sexify:task.patient }} de 
		{% for ap in task.get_ap_list %}
			{% if forloop.last and not forloop.first %}
					 y {{ap}}
				{% else %}
					{% if forloop.revcounter0 > 1 %}
						{{ap}}, 
					{% else %}
						{{ap}}
					{% endif %}
				{% endif %}
		{%  endfor %}
	{% else %}
		No ha sido {{ 'diagnosticado/a'|sexify:task.patient }}
	{% endif %}
	con anterioridad y en su familia
	{% if task.get_af_dict|length %}
		también existen antecedentes de enfermedades psiquiátricas, en concreto
		{% for person, af_list in task.get_af_dict.items %}
			{% if forloop.last and not forloop.first %}
				 y su {{person|lower}} está diagnosticado de
				 {% for illness in af_list %}
					{% if forloop.last and not forloop.first %}
						 y {{illness}}.
					{% else %}
						{% if forloop.revcounter0 > 1%}
							{{illness}}, 
						{% else %}
							{{illness}}
						{% endif %}
					{% endif %}
				{%  endfor %}
			{% else %}
				{% if forloop.revcounter0 %}
					su {{person|lower}} está diagnosticado de 
					{% for illness in af_list %}
						{% if forloop.last and not forloop.first %}
							 y {{illness}},
						{% else %}
							{% if forloop.revcounter0 > 1 %}
								{{illness}}, 
							{% else %}
								{{illness}},
							{% endif %}
						{% endif %}
					{% endfor %}
				{% else %}
					su {{person|lower}} está diagnosticado de 
					{% for illness in af_list %}
						{% if forloop.last and not forloop.first %}
							 y {{illness}}.
						{% else %}
							{% if forloop.revcounter0 > 1 %}
								{{illness}}, 
							{% else %}
								{{illness}}
							{% endif %}
						{% endif %}
					{%  endfor %}
				{% endif %}
			{% endif %}
			
			
		{%  endfor %}
	{% else %}
		no existen antecedentes de enfermedades psiquiátricas.
	{% endif %}
</p>
<p>{{patient.name}} 
	{% if task.get_organicity_list %}
		padece
		{% for org in task.get_organicity_list %}
			{% if forloop.last and not forloop.first %}
				 y {{org}}
			{% else %}
				{% if forloop.revcounter0 > 1 %}
					{{org}}, 
				{% else %}
					{{org}}
				{% endif %}
			{% endif %}
		{%  endfor %}
	{% else %}
		no padece de enfermedad orgánica diagnosticada y
	{% endif %}
	{% if task.get_organicity_list %}
	y
	{% endif %}
	{% if prev_treatment %}
	se medica con
		{% for med in prev_treatment %}
			{% if forloop.last and not forloop.first %}
				 y {{med.component.name}} {{med.posology|floatformat:"-4" }} mg/24 horas desde hace {{med.months|floatformat:"-2"}} mes{{med.months|pluralize:'es'}}.
			{% else %}
				{% if forloop.revcounter0 > 1 %}
					{{med.component.name}} {{med.posology|floatformat:"-4"}} mg/24 horas desde hace {{med.months|floatformat:"-2"}} mes{{med.months|pluralize:'es'}}, 
				{% else %}
					{{med.component.name}} {{med.posology|floatformat:"-4"}} mg/24 horas desde hace {{med.months|floatformat:"-2"}} mes{{med.months|pluralize:'es'}}
				{% endif %}
			{% endif %}
		
		{%  endfor %}
	{% else %}
		no toma ninguna medicación.
	{% endif %}
</p>
{% if organicity_list or medicaments_list %}
	<p>Según estos antecedentes, convendría que el/la paciente revisara
		{% if organicity_list %}
				su
			{% for org in organicity_list %}
				{% if forloop.last and not forloop.first %}
					 y {{org}}
				{% else %}
					{% if forloop.revcounter0 > 1 %}
						{{org}}, 
					{% else %}
						{{org}}
					{% endif %}
				{% endif %}
			{%  endfor %}
		{% endif %}
		{% if medicaments_list %}
			{% if organicity_list and medicaments_list %}
				y/o 
			{% endif %}
			su medicación de
			{% for med in medicaments_list %}
				{% if forloop.last and not forloop.first %}
					 y {{med.component.name}}
				{% else %}
					{% if forloop.revcounter0 > 1 %}
						{{med.component.name}}, 
					{% else %}
						{{med.component.name}}
					{% endif %}
				{% endif %}
			
			{%  endfor %}
		{% endif %}
	para valorar la posible influencia de 
		{% if organicity_list|length > 1 %}
			dichas enfemerdades
		{% else %}
			{% if organicity_list|length = 1 %}
				dicha enfermedad
			{% endif %}
		{% endif %}
		{% if organicity_list and medicaments_list %}
				y de
		{% endif %}
		{% if medicaments_list %}
				dicha medicación
			{% endif %}
		como posible factor etiológico y/o de empeoramiento en su sintomatología.
	</p>
	{% endif %}
{% endif %}


{% include 'consulting/consultation/report/anxiety_depression.html' %}
{% if task.survey.id > 2 %}
{% include 'consulting/consultation/report/marks.html' %}
{% endif %}

{% if task.survey.code = 6 %}
	{% draw_self_register task.observations %}
{% endif %}

<div>
	{% if conclusions %}
	<dl>
	    <dt>{% trans 'OBSERVACIONES' %}</dt>
	    {% for c in conclusions %}   
	    {% if c.observation %}
	    <dd>{{c.observation}}</dd>
	    {% endif %}
	    {% endfor %}
	    <br>
	    <dt>{% trans 'RECOMENDACIONES' %}</dt>
	   	{% for c in conclusions %}   
	    {% if c.recommendation %}
	    <dd>{{c.recommendation}}</dd>
	    {% endif %}
	    {% endfor %}
	 </dl>
	 {% endif %}
</div>

{% if treatment.count > 0 %}
<div>
	<dl>
		<dt>{% trans 'TRATAMIENTO' %}</dt>
		{% for m in treatment %}
  		<dd>
    		{{m.component}} [{{m.posology|floatformat:"-4"}} mg/día]
  		</dd>
	  	{% endfor %}

	</dl>
</div>
{% endif %}

<div style="margin: 0 auto;">
{% for block, answers_list in task.get_answers_by_block %}
<hr style="border: 1px dashed grey; height: 0; width: 60%; margin-left: 20%">
	{% for a in answers_list %}
	<div class="row-fluid">
		<span class="span7" style="text-align: right"><strong>{{a.question|sexify:task.patient}}</strong></span>
		<span class="span5">{% for e in a.answers %}{{e|sexify:task.patient}}{% if forloop.revcounter0 %}, {% endif %}{% endfor %}</span>
	 </div>
	 <br>
	{% endfor %}
{% endfor%}
<hr style="border: 1px dashed grey; height: 0; width: 60%; margin-left: 20%">
</div>
{% endblock container %}