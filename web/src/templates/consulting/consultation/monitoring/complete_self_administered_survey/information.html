{% extends "consulting/consultation/monitoring/index.html" %}

{% load i18n%}

{% block container %}
        <input name="csrfmiddlewaretoken" type="hidden" value="{{csrf_token}}">
        <section>
          <div class="page-header">
              <h1>{% trans 'Encuesta autoadministrada' %}</h1>
          </div>
          <div class="row">       
            <div class="span8">            
              {% if task %}
                <p class="alert alert-info">
                  {% trans 'Fecha de cumplimentación: ' %}{{task.end_date}}
                </p>
                <table class="table table-bordered table-condensed">  
                  <thead>
                    <tr>
                      <th style="text-align:center;">
                        {% trans 'Variable' %}
                      </th>           
                      <th style="text-align:center;">
                        {% trans 'Puntuación' %}
                      </th>                                   
                    </tr>
                  </thead>        
                  <tcontainer>                  
                    {% for variable in variables %}
                    <tr>
                      {% for var in variable %}
                      <td style="text-align:center;">{{var}}</td>
                      {% endfor %}
                    </tr>
                    {% endfor %}
                  </tcontainer>
                </table>
                {% if symptoms_worsening %}
                <table id="sw" class="table table-bordered table-condensed">  
                  <thead>
                    <tr>
                      <th style="text-align:center;">
                        {% trans 'Síntomas o empeoramiento' %}
                      </th>           
                      <th style="text-align:center;">
                        {% trans 'Fecha' %}
                      </th>                                   
                    </tr>
                  </thead>        
                  <tcontainer>                  
                    {% for sw in symptoms_worsening %}
                    <tr>                      
                      <td style="text-align:center;">{{sw|first}}</td>
                      <td style="text-align:center;">{{sw|last}}</td>
                    </tr>
                    {% endfor %}
                  </tcontainer>
                </table>
                {% if more_variables %}
                <p id="more_variables" class="alert alert-error">
                  {% trans '¿Desea valorar alguna variable no evaluada en la encuesta autoadministrada?' %}
                </p>
                {% endif %}
                {% endif %}
              {% else %}
                <p>{{warning}}</p>
              {% endif %}
            </div>       
          </div>                          
        </section>
{% endblock container %}

{% block jquery_init %}
  <!-- ASSESS TASK -->
  $('.assess_task').each(function(){
    $(this).on("click", function(){ 
                            var id = $(this).attr("id");
                            $('#id_task').val(id);     
                        });      
  });

  <!-- ¿ASSESS? -->
  $("#more_variables").click(function(){
    
    window.location.href = '/consultation/monitoring/complete_self_administered_survey/select_not_assessed_variables/' +{{appointment.id}} + '/'+ {{id_result}};
  });
{% endblock %}