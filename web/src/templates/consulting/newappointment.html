{% extends "ui/app.html" %}

{% load i18n%}

{% block js_files %}
  {{ block.super }}
  <script src="{{ STATIC_URL }}js/bootstrap-datepicker.js"></script>
  <script src="{{ STATIC_URL }}js/calendar.js"></script>
{% endblock %}

{% block css_files %}
  {{ block.super }}
  <link href="{{ STATIC_URL }}css/datepicker.css" rel="stylesheet">
  <link href="{{ STATIC_URL }}css/calendar.css" rel="stylesheet"/>
{% endblock %}

{% block jquery_init %}
  <!-- CALENDAR -->
  var evnts = function(){
                return {
                        "event": [
                             {"date":"2012-01-25","title":"1"}
                            ,{"date":"2012-02-01","title":"2"}
                            ,{"date":"2012-03-22","title":"34"}
                            ,{"date":"2012-04-03","title":"123"}
                            ,{"date":"2012-05-04","title":"223"}
                            ,{"date":"2012-06-28","title":"4"}
                            ,{"date":"2012-07-28","title":"5"}
                            ,{"date":"2012-08-16","title":"14"}
                            ,{"date":"2012-09-21","title":"10"}
                            ,{"date":"2012-10-21","title":"10"}
                            ,{"date":"2012-11-21","title":"10"}
                            ,{"date":"2012-12-21","title":"10"}
                        ]
                      }
              };
  $('#calendar').Calendar({ 'events': evnts, 'weekStart': 1 })
       .on('changeDay', function(event){ alert(event.day.valueOf()); })
       .on('onEvent', function(event){ alert(event.day.valueOf()); })
       .on('onNext', function(event){ alert("Next"); })
       .on('onPrev', function(event){ alert("Prev"); })
       .on('onCurrent', function(event){ alert("Current"); });

  <!-- DATAPICKER -->
  $('#dp').datepicker().on('changeDate',
    function(ev){$('#dp').datepicker('hide');
  });
  <!-- DOCTOR'S APPOINTMENTS -->
  $('#doctor').change(function() {
    var doctor_id = $("#id_doctor option:selected").val()

    $('#overwrite_appointments_doctor_day').load(
                            '{% url consulting_appointments_doctor %}',
                            {'doctor_id': doctor_id,
                            'csrfmiddlewaretoken': $('input[name="csrfmiddlewaretoken"]').val()});
  });
{% endblock %}

{% block header%}
    {% include "ui/includes/header_administrative.html" %}
{% endblock  %}

{% block body %}
  <div class="container">
    <section>
      <div class="page-header">
        <h1>{% trans 'Cita' %}</h1>                
      </div>
      <div class="row" >
        <div class="span4" id="calendar"/></div>
        <div class="span4">
          <form class="form-horizontal" id="form"
                action="{% url consulting_newappointment newpatient_id %}" method="post" accept-charset="utf-8">{% csrf_token %}          
            <div class="control-group">              
              <label class="control-label">
                {{form.doctor.label}}
              </label>
              <div id="doctor" class="controls">
                {{form.doctor}}
                {% if form.doctor.errors %}
                  {{ form.doctor.errors }}
                {% endif %}
              </div>
              <div class="control-group">
                <div id="appointments"></div>
              </div>
            </div>
            <div class="control-group">
              <label class="control-label">
                {{form.date.label}}
              </label>
              <div class="controls">
                <div id="dp" class="input-append date" data-date-format="dd/mm/yyyy" data-date-weekstart="1">
                  {{form.date}}
                  <span class="add-on">
                    <i class="icon-th"></i>
                  </span>
                </div>
                {% if form.date.errors %}
                  {{ form.date.errors }}
                {% endif %}
              </div>
            </div>
            <div class="control-group">
              <label class="control-label">
                {{form.hour.label}}
              </label>
              <div class="controls">
                {{form.hour}}
                {% if form.hour.errors %}
                  {{ form.hour.errors }}
                {% endif %}
                <span class="help-inline">{% trans 'Formato HH:MM' %}</span>
              </div>
            </div>
            <div class="controls">
              <button type="submit" class="btn">{% trans 'Guardar' %}</button>
            </div>
          </form>
        </div>
        <div class="span4">
          <div id="overwrite_appointments_doctor_day"></div>
        </div>
      </div>
    </section>
  </div>
{% endblock body %}
